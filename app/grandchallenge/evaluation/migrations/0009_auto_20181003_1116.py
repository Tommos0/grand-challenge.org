# Generated by Django 2.0.8 on 2018-10-03 11:16

from django.db import migrations, models


def set_supplementary_file_option_forward(apps, schema_editor):
    Config = apps.get_model("evaluation", "Config")
    for config in Config.objects.all():
        if config.require_supplementary_file:
            config.supplementary_file_choice = Config.REQUIRED
        elif config.allow_supplementary_file:
            config.supplementary_file_choice = Config.ALLOWED
        else:
            config.supplementary_file_choice = Config.OFF
        config.save()


class Migration(migrations.Migration):

    dependencies = [("evaluation", "0008_config_submission_join_key")]

    operations = [
        migrations.AddField(
            model_name="config",
            name="supplementary_file_choice",
            field=models.CharField(
                choices=[
                    ("off", "Off"),
                    ("opt", "Optional"),
                    ("req", "Required"),
                ],
                default="off",
                help_text="Show a supplementary file field on the submissions page so that users can upload an additional file along with their predictions file as part of their submission (eg, include a pdf description of their method). Off turns this feature off, Optional means that including the file is optional for the user, Required means that the user must upload a supplementary file.",
                max_length=3,
            ),
        ),
        migrations.RunPython(set_supplementary_file_option_forward),
        migrations.RemoveField(
            model_name="config", name="allow_supplementary_file"
        ),
        migrations.RemoveField(
            model_name="config", name="require_supplementary_file"
        ),
    ]
